<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Estimate Partition Function — estimate_partition_function • BayesMallows</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Estimate Partition Function — estimate_partition_function"><meta name="description" content="Estimate the logarithm of the partition function of the Mallows rank model.
Choose between the importance sampling algorithm described in
(Vitelli et al. 2018)
 and the IPFP algorithm for computing
an asymptotic approximation described in
(Mukherjee 2016)
. Note that exact partition functions
can be computed efficiently for Cayley, Hamming and Kendall distances with
any number of items, for footrule distances with up to 50 items, Spearman
distance with up to 20 items, and Ulam distance with up to 60 items. This
function is thus intended for the complement of these cases. See
get_cardinalities() and compute_exact_partition_function() for details."><meta property="og:description" content="Estimate the logarithm of the partition function of the Mallows rank model.
Choose between the importance sampling algorithm described in
(Vitelli et al. 2018)
 and the IPFP algorithm for computing
an asymptotic approximation described in
(Mukherjee 2016)
. Note that exact partition functions
can be computed efficiently for Cayley, Hamming and Kendall distances with
any number of items, for footrule distances with up to 50 items, Spearman
distance with up to 20 items, and Ulam distance with up to 60 items. This
function is thus intended for the complement of these cases. See
get_cardinalities() and compute_exact_partition_function() for details."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">BayesMallows</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.2.5</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/BayesMallows.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/parallel_chains.html">MCMC with Parallel Chains</a></li>
    <li><a class="dropdown-item" href="../articles/SMC-Mallows.html">Sequential Monte Carlo for the Bayesian Mallows model</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ocbe-uio/BayesMallows/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Estimate Partition Function</h1>
      <small class="dont-index">Source: <a href="https://github.com/ocbe-uio/BayesMallows/blob/v2.2.5/R/estimate_partition_function.R" class="external-link"><code>R/estimate_partition_function.R</code></a></small>
      <div class="d-none name"><code>estimate_partition_function.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Estimate the logarithm of the partition function of the Mallows rank model.
Choose between the importance sampling algorithm described in
(Vitelli et al. 2018)
 and the IPFP algorithm for computing
an asymptotic approximation described in
(Mukherjee 2016)
. Note that exact partition functions
can be computed efficiently for Cayley, Hamming and Kendall distances with
any number of items, for footrule distances with up to 50 items, Spearman
distance with up to 20 items, and Ulam distance with up to 60 items. This
function is thus intended for the complement of these cases. See
<code><a href="get_cardinalities.html">get_cardinalities()</a></code> and <code><a href="compute_exact_partition_function.html">compute_exact_partition_function()</a></code> for details.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">estimate_partition_function</span><span class="op">(</span></span>
<span>  method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"importance_sampling"</span>, <span class="st">"asymptotic"</span><span class="op">)</span>,</span>
<span>  <span class="va">alpha_vector</span>,</span>
<span>  <span class="va">n_items</span>,</span>
<span>  <span class="va">metric</span>,</span>
<span>  <span class="va">n_iterations</span>,</span>
<span>  K <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  cl <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-method">method<a class="anchor" aria-label="anchor" href="#arg-method"></a></dt>
<dd><p>Character string specifying the method to use in order to
estimate the logarithm of the partition function. Available options are
<code>"importance_sampling"</code> and <code>"asymptotic"</code>.</p></dd>


<dt id="arg-alpha-vector">alpha_vector<a class="anchor" aria-label="anchor" href="#arg-alpha-vector"></a></dt>
<dd><p>Numeric vector of \(\alpha\) values over which to
compute the importance sampling estimate.</p></dd>


<dt id="arg-n-items">n_items<a class="anchor" aria-label="anchor" href="#arg-n-items"></a></dt>
<dd><p>Integer specifying the number of items.</p></dd>


<dt id="arg-metric">metric<a class="anchor" aria-label="anchor" href="#arg-metric"></a></dt>
<dd><p>Character string specifying the distance measure to use.
Available options are <code>"footrule"</code> and <code>"spearman"</code> when <code>method = "asymptotic"</code> and in addition <code>"cayley"</code>, <code>"hamming"</code>, <code>"kendall"</code>, and
<code>"ulam"</code> when <code>method = "importance_sampling"</code>.</p></dd>


<dt id="arg-n-iterations">n_iterations<a class="anchor" aria-label="anchor" href="#arg-n-iterations"></a></dt>
<dd><p>Integer specifying the number of iterations to use. When
<code>method = "importance_sampling"</code>, this is the number of Monte Carlo samples
to generate. When <code>method = "asymptotic"</code>, on the other hand, it represents
the number of iterations of the IPFP algorithm.</p></dd>


<dt id="arg-k">K<a class="anchor" aria-label="anchor" href="#arg-k"></a></dt>
<dd><p>Integer specifying the parameter \(K\) in the asymptotic
approximation of the partition function. Only used when <code>method = "asymptotic"</code>. Defaults to 20.</p></dd>


<dt id="arg-cl">cl<a class="anchor" aria-label="anchor" href="#arg-cl"></a></dt>
<dd><p>Optional computing cluster used for parallelization, returned from
<code><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">parallel::makeCluster()</a></code>. Defaults to <code>NULL</code>. Only used when <code>method = "importance_sampling"</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A matrix with two column and number of rows equal the degree of the
fitted polynomial approximating the partition function. The matrix can be
supplied to the <code>pfun_estimate</code> argument of <code><a href="compute_mallows.html">compute_mallows()</a></code>.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Mukherjee S (2016).
“Estimation in exponential families on permutations.”
<em>The Annals of Statistics</em>, <b>44</b>(2), 853–875.
<a href="https://doi.org/10.1214/15-aos1389" class="external-link">doi:10.1214/15-aos1389</a>
.<br><br> Vitelli V, Sørensen, Crispino M, Arjas E, Frigessi A (2018).
“Probabilistic Preference Learning with the Mallows Rank Model.”
<em>Journal of Machine Learning Research</em>, <b>18</b>(1), 1–49.
<a href="https://jmlr.org/papers/v18/15-481.html" class="external-link">https://jmlr.org/papers/v18/15-481.html</a>.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Other partition function:
<code><a href="compute_exact_partition_function.html">compute_exact_partition_function</a>()</code>,
<code><a href="get_cardinalities.html">get_cardinalities</a>()</code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># IMPORTANCE SAMPLING</span></span></span>
<span class="r-in"><span><span class="co"># Let us estimate logZ(alpha) for 20 items with Spearman distance</span></span></span>
<span class="r-in"><span><span class="co"># We create a grid of alpha values from 0 to 10</span></span></span>
<span class="r-in"><span><span class="va">alpha_vector</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">0</span>, to <span class="op">=</span> <span class="fl">10</span>, by <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">n_items</span> <span class="op">&lt;-</span> <span class="fl">20</span></span></span>
<span class="r-in"><span><span class="va">metric</span> <span class="op">&lt;-</span> <span class="st">"spearman"</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># We start with 1e3 Monte Carlo samples</span></span></span>
<span class="r-in"><span><span class="va">fit1</span> <span class="op">&lt;-</span> <span class="fu">estimate_partition_function</span><span class="op">(</span></span></span>
<span class="r-in"><span>  method <span class="op">=</span> <span class="st">"importance_sampling"</span>, alpha_vector <span class="op">=</span> <span class="va">alpha_vector</span>,</span></span>
<span class="r-in"><span>  n_items <span class="op">=</span> <span class="va">n_items</span>, metric <span class="op">=</span> <span class="va">metric</span>, n_iterations <span class="op">=</span> <span class="fl">1e3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># A matrix containing powers of alpha and regression coefficients is returned</span></span></span>
<span class="r-in"><span><span class="va">fit1</span></span></span>
<span class="r-in"><span><span class="co"># The approximated partition function can hence be obtained:</span></span></span>
<span class="r-in"><span><span class="va">estimate1</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">vapply</a></span><span class="op">(</span><span class="va">alpha_vector</span>, <span class="kw">function</span><span class="op">(</span><span class="va">a</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">a</span><span class="op">^</span><span class="va">fit1</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="va">fit1</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Now let us recompute with 2e3 Monte Carlo samples</span></span></span>
<span class="r-in"><span><span class="va">fit2</span> <span class="op">&lt;-</span> <span class="fu">estimate_partition_function</span><span class="op">(</span></span></span>
<span class="r-in"><span>  method <span class="op">=</span> <span class="st">"importance_sampling"</span>, alpha_vector <span class="op">=</span> <span class="va">alpha_vector</span>,</span></span>
<span class="r-in"><span>  n_items <span class="op">=</span> <span class="va">n_items</span>, metric <span class="op">=</span> <span class="va">metric</span>, n_iterations <span class="op">=</span> <span class="fl">2e3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">estimate2</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">vapply</a></span><span class="op">(</span><span class="va">alpha_vector</span>, <span class="kw">function</span><span class="op">(</span><span class="va">a</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">a</span><span class="op">^</span><span class="va">fit2</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="va">fit2</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># ASYMPTOTIC APPROXIMATION</span></span></span>
<span class="r-in"><span><span class="co"># We can also compute an estimate using the asymptotic approximation</span></span></span>
<span class="r-in"><span><span class="va">fit3</span> <span class="op">&lt;-</span> <span class="fu">estimate_partition_function</span><span class="op">(</span></span></span>
<span class="r-in"><span>  method <span class="op">=</span> <span class="st">"asymptotic"</span>, alpha_vector <span class="op">=</span> <span class="va">alpha_vector</span>,</span></span>
<span class="r-in"><span>  n_items <span class="op">=</span> <span class="va">n_items</span>, metric <span class="op">=</span> <span class="va">metric</span>, n_iterations <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">estimate3</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">vapply</a></span><span class="op">(</span><span class="va">alpha_vector</span>, <span class="kw">function</span><span class="op">(</span><span class="va">a</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">a</span><span class="op">^</span><span class="va">fit3</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="va">fit3</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># We can now plot the estimates side-by-side</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">alpha_vector</span>, <span class="va">estimate1</span>, type <span class="op">=</span> <span class="st">"l"</span>, xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">alpha</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>     ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fu">Z</span><span class="op">(</span><span class="va">alpha</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">alpha_vector</span>, <span class="va">estimate2</span>, col <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">alpha_vector</span>, <span class="va">estimate3</span>, col <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">7</span>, y <span class="op">=</span> <span class="fl">40</span>, legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"IS,1e3"</span>, <span class="st">"IS,2e3"</span>, <span class="st">"IPFP"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>       col <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, lty <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># We see that the two importance sampling estimates, which are unbiased,</span></span></span>
<span class="r-in"><span><span class="co"># overlap. The asymptotic approximation seems a bit off. It can be worthwhile</span></span></span>
<span class="r-in"><span><span class="co"># to try different values of n_iterations and K.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># When we are happy, we can provide the coefficient vector in the</span></span></span>
<span class="r-in"><span><span class="co"># pfun_estimate argument to compute_mallows</span></span></span>
<span class="r-in"><span><span class="co"># Say we choose to use the importance sampling estimate with 1e4 Monte Carlo samples:</span></span></span>
<span class="r-in"><span><span class="va">model_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="compute_mallows.html">compute_mallows</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="setup_rank_data.html">setup_rank_data</a></span><span class="op">(</span><span class="va">potato_visual</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  model_options <span class="op">=</span> <span class="fu"><a href="set_model_options.html">set_model_options</a></span><span class="op">(</span>metric <span class="op">=</span> <span class="st">"spearman"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  compute_options <span class="op">=</span> <span class="fu"><a href="set_compute_options.html">set_compute_options</a></span><span class="op">(</span>nmc <span class="op">=</span> <span class="fl">200</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  pfun_estimate <span class="op">=</span> <span class="va">fit2</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Oystein Sorensen, Waldir Leoncio, Valeria Vitelli, Marta Crispino, Qinghua Liu, Cristina Mollica, Luca Tardella, Anja Stein.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

