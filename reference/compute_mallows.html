<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Preference Learning with the Mallows Rank Model — compute_mallows • BayesMallows</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Preference Learning with the Mallows Rank Model — compute_mallows"><meta name="description" content="Compute the posterior distributions of the parameters of the
Bayesian Mallows Rank Model, given rankings or preferences stated by a set
of assessors.
The BayesMallows package uses the following parametrization of the
Mallows rank model (Mallows 1957)
:
$$p(r|\alpha,\rho) = \frac{1}{Z_{n}(\alpha)} \exp\left\{\frac{-\alpha}{n}
  d(r,\rho)\right\}$$
where \(r\) is a ranking, \(\alpha\) is a scale parameter, \(\rho\)
is the latent consensus ranking, \(Z_{n}(\alpha)\) is the partition
function (normalizing constant), and \(d(r,\rho)\) is a distance function
measuring the distance between \(r\) and \(\rho\). We refer to
Vitelli et al. (2018)
 for further details of the
Bayesian Mallows model.
compute_mallows always returns posterior distributions of the latent
consensus ranking \(\rho\) and the scale parameter \(\alpha\). Several
distance measures are supported, and the preferences can take the form of
complete or incomplete rankings, as well as pairwise preferences.
compute_mallows can also compute mixtures of Mallows models, for
clustering of assessors with similar preferences."><meta property="og:description" content="Compute the posterior distributions of the parameters of the
Bayesian Mallows Rank Model, given rankings or preferences stated by a set
of assessors.
The BayesMallows package uses the following parametrization of the
Mallows rank model (Mallows 1957)
:
$$p(r|\alpha,\rho) = \frac{1}{Z_{n}(\alpha)} \exp\left\{\frac{-\alpha}{n}
  d(r,\rho)\right\}$$
where \(r\) is a ranking, \(\alpha\) is a scale parameter, \(\rho\)
is the latent consensus ranking, \(Z_{n}(\alpha)\) is the partition
function (normalizing constant), and \(d(r,\rho)\) is a distance function
measuring the distance between \(r\) and \(\rho\). We refer to
Vitelli et al. (2018)
 for further details of the
Bayesian Mallows model.
compute_mallows always returns posterior distributions of the latent
consensus ranking \(\rho\) and the scale parameter \(\alpha\). Several
distance measures are supported, and the preferences can take the form of
complete or incomplete rankings, as well as pairwise preferences.
compute_mallows can also compute mixtures of Mallows models, for
clustering of assessors with similar preferences."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">BayesMallows</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.2.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/BayesMallows.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/parallel_chains.html">MCMC with Parallel Chains</a></li>
    <li><a class="dropdown-item" href="../articles/SMC-Mallows.html">Sequential Monte Carlo for the Bayesian Mallows model</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ocbe-uio/BayesMallows/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Preference Learning with the Mallows Rank Model</h1>
      <small class="dont-index">Source: <a href="https://github.com/ocbe-uio/BayesMallows/blob/v2.2.2/R/compute_mallows.R" class="external-link"><code>R/compute_mallows.R</code></a></small>
      <div class="d-none name"><code>compute_mallows.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Compute the posterior distributions of the parameters of the
Bayesian Mallows Rank Model, given rankings or preferences stated by a set
of assessors.</p>
<p>The <code>BayesMallows</code> package uses the following parametrization of the
Mallows rank model (Mallows 1957)
:</p>
<p>$$p(r|\alpha,\rho) = \frac{1}{Z_{n}(\alpha)} \exp\left\{\frac{-\alpha}{n}
  d(r,\rho)\right\}$$</p>
<p>where \(r\) is a ranking, \(\alpha\) is a scale parameter, \(\rho\)
is the latent consensus ranking, \(Z_{n}(\alpha)\) is the partition
function (normalizing constant), and \(d(r,\rho)\) is a distance function
measuring the distance between \(r\) and \(\rho\). We refer to
Vitelli et al. (2018)
 for further details of the
Bayesian Mallows model.</p>
<p><code>compute_mallows</code> always returns posterior distributions of the latent
consensus ranking \(\rho\) and the scale parameter \(\alpha\). Several
distance measures are supported, and the preferences can take the form of
complete or incomplete rankings, as well as pairwise preferences.
<code>compute_mallows</code> can also compute mixtures of Mallows models, for
clustering of assessors with similar preferences.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">compute_mallows</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  model_options <span class="op">=</span> <span class="fu"><a href="set_model_options.html">set_model_options</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  compute_options <span class="op">=</span> <span class="fu"><a href="set_compute_options.html">set_compute_options</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  priors <span class="op">=</span> <span class="fu"><a href="set_priors.html">set_priors</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  initial_values <span class="op">=</span> <span class="fu"><a href="set_initial_values.html">set_initial_values</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  pfun_estimate <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  progress_report <span class="op">=</span> <span class="fu"><a href="set_progress_report.html">set_progress_report</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  cl <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>An object of class "BayesMallowsData" returned from
<code><a href="setup_rank_data.html">setup_rank_data()</a></code>.</p></dd>


<dt id="arg-model-options">model_options<a class="anchor" aria-label="anchor" href="#arg-model-options"></a></dt>
<dd><p>An object of class "BayesMallowsModelOptions" returned
from <code><a href="set_model_options.html">set_model_options()</a></code>.</p></dd>


<dt id="arg-compute-options">compute_options<a class="anchor" aria-label="anchor" href="#arg-compute-options"></a></dt>
<dd><p>An object of class "BayesMallowsComputeOptions"
returned from <code><a href="set_compute_options.html">set_compute_options()</a></code>.</p></dd>


<dt id="arg-priors">priors<a class="anchor" aria-label="anchor" href="#arg-priors"></a></dt>
<dd><p>An object of class "BayesMallowsPriors" returned from
<code><a href="set_priors.html">set_priors()</a></code>.</p></dd>


<dt id="arg-initial-values">initial_values<a class="anchor" aria-label="anchor" href="#arg-initial-values"></a></dt>
<dd><p>An object of class "BayesMallowsInitialValues" returned
from <code><a href="set_initial_values.html">set_initial_values()</a></code>.</p></dd>


<dt id="arg-pfun-estimate">pfun_estimate<a class="anchor" aria-label="anchor" href="#arg-pfun-estimate"></a></dt>
<dd><p>Object returned from <code><a href="estimate_partition_function.html">estimate_partition_function()</a></code>.
Defaults to <code>NULL</code>, and will only be used for footrule, Spearman, or
Ulam distances when the cardinalities are not available, cf.
<code><a href="get_cardinalities.html">get_cardinalities()</a></code>.</p></dd>


<dt id="arg-progress-report">progress_report<a class="anchor" aria-label="anchor" href="#arg-progress-report"></a></dt>
<dd><p>An object of class "BayesMallowsProgressReported"
returned from <code><a href="set_progress_report.html">set_progress_report()</a></code>.</p></dd>


<dt id="arg-cl">cl<a class="anchor" aria-label="anchor" href="#arg-cl"></a></dt>
<dd><p>Optional cluster returned from <code><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">parallel::makeCluster()</a></code>. If
provided, chains will be run in parallel, one on each node of <code>cl</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An object of class BayesMallows.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Mallows CL (1957).
“Non-Null Ranking Models. I.”
<em>Biometrika</em>, <b>44</b>(1/2), 114–130.<br><br> Vitelli V, Sørensen, Crispino M, Arjas E, Frigessi A (2018).
“Probabilistic Preference Learning with the Mallows Rank Model.”
<em>Journal of Machine Learning Research</em>, <b>18</b>(1), 1–49.
<a href="https://jmlr.org/papers/v18/15-481.html" class="external-link">https://jmlr.org/papers/v18/15-481.html</a>.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Other modeling:
<code><a href="burnin.html">burnin</a>()</code>,
<code>burnin&lt;-()</code>,
<code><a href="compute_mallows_mixtures.html">compute_mallows_mixtures</a>()</code>,
<code><a href="compute_mallows_sequentially.html">compute_mallows_sequentially</a>()</code>,
<code><a href="sample_prior.html">sample_prior</a>()</code>,
<code><a href="update_mallows.html">update_mallows</a>()</code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># ANALYSIS OF COMPLETE RANKINGS</span></span></span>
<span class="r-in"><span><span class="co"># The example datasets potato_visual and potato_weighing contain complete</span></span></span>
<span class="r-in"><span><span class="co"># rankings of 20 items, by 12 assessors. We first analyse these using the Mallows</span></span></span>
<span class="r-in"><span><span class="co"># model:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">model_fit</span> <span class="op">&lt;-</span> <span class="fu">compute_mallows</span><span class="op">(</span></span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="fu"><a href="setup_rank_data.html">setup_rank_data</a></span><span class="op">(</span>rankings <span class="op">=</span> <span class="va">potato_visual</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  compute_options <span class="op">=</span> <span class="fu"><a href="set_compute_options.html">set_compute_options</a></span><span class="op">(</span>nmc <span class="op">=</span> <span class="fl">2000</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># We study the trace plot of the parameters</span></span></span>
<span class="r-in"><span><span class="fu"><a href="assess_convergence.html">assess_convergence</a></span><span class="op">(</span><span class="va">model_fit</span>, parameter <span class="op">=</span> <span class="st">"alpha"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="compute_mallows-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu"><a href="assess_convergence.html">assess_convergence</a></span><span class="op">(</span><span class="va">model_fit</span>, parameter <span class="op">=</span> <span class="st">"rho"</span>, items <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="compute_mallows-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Based on these plots, we set burnin = 1000.</span></span></span>
<span class="r-in"><span><span class="fu"><a href="burnin.html">burnin</a></span><span class="op">(</span><span class="va">model_fit</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span></span>
<span class="r-in"><span><span class="co"># Next, we use the generic plot function to study the posterior distributions</span></span></span>
<span class="r-in"><span><span class="co"># of alpha and rho</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">model_fit</span>, parameter <span class="op">=</span> <span class="st">"alpha"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="compute_mallows-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">model_fit</span>, parameter <span class="op">=</span> <span class="st">"rho"</span>, items <span class="op">=</span> <span class="fl">10</span><span class="op">:</span><span class="fl">15</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="compute_mallows-4.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># We can also compute the CP consensus posterior ranking</span></span></span>
<span class="r-in"><span><span class="fu"><a href="compute_consensus.html">compute_consensus</a></span><span class="op">(</span><span class="va">model_fit</span>, type <span class="op">=</span> <span class="st">"CP"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      cluster ranking item cumprob</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1  Cluster 1       1  P12   1.000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2  Cluster 1       2  P13   1.000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3  Cluster 1       3   P9   0.876</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4  Cluster 1       4  P10   0.916</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5  Cluster 1       5  P17   0.748</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6  Cluster 1       6   P7   0.882</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7  Cluster 1       7  P14   0.977</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8  Cluster 1       8  P16   0.845</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9  Cluster 1       9   P5   0.605</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10 Cluster 1      10   P1   0.743</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11 Cluster 1      11  P11   0.965</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12 Cluster 1      12  P19   1.000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13 Cluster 1      13  P20   0.582</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 14 Cluster 1      14  P18   1.000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 15 Cluster 1      15   P6   0.916</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 16 Cluster 1      16   P4   0.727</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17 Cluster 1      17   P2   0.780</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 18 Cluster 1      18  P15   1.000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 19 Cluster 1      19   P3   1.000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 20 Cluster 1      20   P8   1.000</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># And we can compute the posterior intervals:</span></span></span>
<span class="r-in"><span><span class="co"># First we compute the interval for alpha</span></span></span>
<span class="r-in"><span><span class="fu"><a href="compute_posterior_intervals.html">compute_posterior_intervals</a></span><span class="op">(</span><span class="va">model_fit</span>, parameter <span class="op">=</span> <span class="st">"alpha"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   parameter   mean median           hpdi central_interval</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1     alpha 10.632 10.704 [8.468,12.259]   [8.473,12.352]</span>
<span class="r-in"><span><span class="co"># Then we compute the interval for all the items</span></span></span>
<span class="r-in"><span><span class="fu"><a href="compute_posterior_intervals.html">compute_posterior_intervals</a></span><span class="op">(</span><span class="va">model_fit</span>, parameter <span class="op">=</span> <span class="st">"rho"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    parameter item mean median      hpdi central_interval</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1        rho   P1   10     10    [9,12]           [9,12]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2        rho   P2   17     17   [16,18]          [16,18]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3        rho   P3   19     19      [19]             [19]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4        rho   P4   16     16   [16,18]          [15,18]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5        rho   P5    9      9 [3][6,11]           [3,11]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6        rho   P6   15     15   [15,16]          [15,18]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7        rho   P7    6      6     [5,7]            [5,7]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8        rho   P8   20     20      [20]             [20]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9        rho   P9    3      3     [3,4]            [3,4]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10       rho  P10    4      4     [3,5]            [3,5]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11       rho  P11   11     11    [9,11]           [9,12]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12       rho  P12    1      1       [1]              [1]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13       rho  P13    2      2       [2]              [2]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 14       rho  P14    7      7     [6,7]            [6,7]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 15       rho  P15   18     18   [17,18]          [15,18]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 16       rho  P16    8      8     [8,9]            [8,9]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17       rho  P17    5      5  [5,6][8]            [5,8]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 18       rho  P18   14     14   [13,14]          [13,14]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 19       rho  P19   12     12  [10][12]          [10,12]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 20       rho  P20   13     13   [13,14]          [13,14]</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># ANALYSIS OF PAIRWISE PREFERENCES</span></span></span>
<span class="r-in"><span><span class="co"># The example dataset beach_preferences contains pairwise</span></span></span>
<span class="r-in"><span><span class="co"># preferences between beaches stated by 60 assessors. There</span></span></span>
<span class="r-in"><span><span class="co"># is a total of 15 beaches in the dataset.</span></span></span>
<span class="r-in"><span><span class="va">beach_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="setup_rank_data.html">setup_rank_data</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  preferences <span class="op">=</span> <span class="va">beach_preferences</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># We then run the Bayesian Mallows rank model</span></span></span>
<span class="r-in"><span><span class="co"># We save the augmented data for diagnostics purposes.</span></span></span>
<span class="r-in"><span><span class="va">model_fit</span> <span class="op">&lt;-</span> <span class="fu">compute_mallows</span><span class="op">(</span></span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">beach_data</span>,</span></span>
<span class="r-in"><span>  compute_options <span class="op">=</span> <span class="fu"><a href="set_compute_options.html">set_compute_options</a></span><span class="op">(</span>save_aug <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  progress_report <span class="op">=</span> <span class="fu"><a href="set_progress_report.html">set_progress_report</a></span><span class="op">(</span>verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> First 1000 iterations of Metropolis-Hastings algorithm completed.</span>
<span class="r-in"><span><span class="co"># We can assess the convergence of the scale parameter</span></span></span>
<span class="r-in"><span><span class="fu"><a href="assess_convergence.html">assess_convergence</a></span><span class="op">(</span><span class="va">model_fit</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="compute_mallows-5.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># We can assess the convergence of latent rankings. Here we</span></span></span>
<span class="r-in"><span><span class="co"># show beaches 1-5.</span></span></span>
<span class="r-in"><span><span class="fu"><a href="assess_convergence.html">assess_convergence</a></span><span class="op">(</span><span class="va">model_fit</span>, parameter <span class="op">=</span> <span class="st">"rho"</span>, items <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="compute_mallows-6.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># We can also look at the convergence of the augmented rankings for</span></span></span>
<span class="r-in"><span><span class="co"># each assessor.</span></span></span>
<span class="r-in"><span><span class="fu"><a href="assess_convergence.html">assess_convergence</a></span><span class="op">(</span><span class="va">model_fit</span>, parameter <span class="op">=</span> <span class="st">"Rtilde"</span>,</span></span>
<span class="r-in"><span>                   items <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span><span class="op">)</span>, assessors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="compute_mallows-7.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># Notice how, for assessor 1, the lines cross each other, while</span></span></span>
<span class="r-in"><span><span class="co"># beach 2 consistently has a higher rank value (lower preference) for</span></span></span>
<span class="r-in"><span><span class="co"># assessor 2. We can see why by looking at the implied orderings in</span></span></span>
<span class="r-in"><span><span class="co"># beach_tc</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="fu"><a href="get_transitive_closure.html">get_transitive_closure</a></span><span class="op">(</span><span class="va">beach_data</span><span class="op">)</span>, <span class="va">assessor</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span> <span class="op">&amp;</span></span></span>
<span class="r-in"><span>         <span class="va">bottom_item</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">top_item</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    assessor bottom_item top_item</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 49        2           2        4</span>
<span class="r-in"><span><span class="co"># Assessor 1 has no implied ordering between beach 2 and beach 4,</span></span></span>
<span class="r-in"><span><span class="co"># while assessor 2 has the implied ordering that beach 4 is preferred</span></span></span>
<span class="r-in"><span><span class="co"># to beach 2. This is reflected in the trace plots.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># CLUSTERING OF ASSESSORS WITH SIMILAR PREFERENCES</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span>  <span class="co"># The example dataset sushi_rankings contains 5000 complete</span></span></span>
<span class="r-in"><span>  <span class="co"># rankings of 10 types of sushi</span></span></span>
<span class="r-in"><span>  <span class="co"># We start with computing a 3-cluster solution</span></span></span>
<span class="r-in"><span>  <span class="va">model_fit</span> <span class="op">&lt;-</span> <span class="fu">compute_mallows</span><span class="op">(</span></span></span>
<span class="r-in"><span>    data <span class="op">=</span> <span class="fu"><a href="setup_rank_data.html">setup_rank_data</a></span><span class="op">(</span><span class="va">sushi_rankings</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    model_options <span class="op">=</span> <span class="fu"><a href="set_model_options.html">set_model_options</a></span><span class="op">(</span>n_clusters <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    compute_options <span class="op">=</span> <span class="fu"><a href="set_compute_options.html">set_compute_options</a></span><span class="op">(</span>nmc <span class="op">=</span> <span class="fl">10000</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    progress_report <span class="op">=</span> <span class="fu"><a href="set_progress_report.html">set_progress_report</a></span><span class="op">(</span>verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="co"># We then assess convergence of the scale parameter alpha</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="assess_convergence.html">assess_convergence</a></span><span class="op">(</span><span class="va">model_fit</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="co"># Next, we assess convergence of the cluster probabilities</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="assess_convergence.html">assess_convergence</a></span><span class="op">(</span><span class="va">model_fit</span>, parameter <span class="op">=</span> <span class="st">"cluster_probs"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="co"># Based on this, we set burnin = 1000</span></span></span>
<span class="r-in"><span>  <span class="co"># We now plot the posterior density of the scale parameters alpha in</span></span></span>
<span class="r-in"><span>  <span class="co"># each mixture:</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="burnin.html">burnin</a></span><span class="op">(</span><span class="va">model_fit</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">model_fit</span>, parameter <span class="op">=</span> <span class="st">"alpha"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="co"># We can also compute the posterior density of the cluster probabilities</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">model_fit</span>, parameter <span class="op">=</span> <span class="st">"cluster_probs"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="co"># We can also plot the posterior cluster assignment. In this case,</span></span></span>
<span class="r-in"><span>  <span class="co"># the assessors are sorted according to their maximum a posteriori cluster estimate.</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">model_fit</span>, parameter <span class="op">=</span> <span class="st">"cluster_assignment"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="co"># We can also assign each assessor to a cluster</span></span></span>
<span class="r-in"><span>  <span class="va">cluster_assignments</span> <span class="op">&lt;-</span> <span class="fu"><a href="assign_cluster.html">assign_cluster</a></span><span class="op">(</span><span class="va">model_fit</span>, soft <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># DETERMINING THE NUMBER OF CLUSTERS</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span>  <span class="co"># Continuing with the sushi data, we can determine the number of cluster</span></span></span>
<span class="r-in"><span>  <span class="co"># Let us look at any number of clusters from 1 to 10</span></span></span>
<span class="r-in"><span>  <span class="co"># We use the convenience function compute_mallows_mixtures</span></span></span>
<span class="r-in"><span>  <span class="va">n_clusters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">1</span>, to <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">models</span> <span class="op">&lt;-</span> <span class="fu"><a href="compute_mallows_mixtures.html">compute_mallows_mixtures</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    n_clusters <span class="op">=</span> <span class="va">n_clusters</span>,</span></span>
<span class="r-in"><span>    data <span class="op">=</span> <span class="fu"><a href="setup_rank_data.html">setup_rank_data</a></span><span class="op">(</span>rankings <span class="op">=</span> <span class="va">sushi_rankings</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    compute_options <span class="op">=</span> <span class="fu"><a href="set_compute_options.html">set_compute_options</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>      nmc <span class="op">=</span> <span class="fl">6000</span>, alpha_jump <span class="op">=</span> <span class="fl">10</span>, include_wcd <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="co"># models is a list in which each element is an object of class BayesMallows,</span></span></span>
<span class="r-in"><span>  <span class="co"># returned from compute_mallows</span></span></span>
<span class="r-in"><span>  <span class="co"># We can create an elbow plot</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="burnin.html">burnin</a></span><span class="op">(</span><span class="va">models</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="plot_elbow.html">plot_elbow</a></span><span class="op">(</span><span class="va">models</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="co"># We then select the number of cluster at a point where this plot has</span></span></span>
<span class="r-in"><span>  <span class="co"># an "elbow", e.g., at 6 clusters.</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># SPEEDING UP COMPUTION WITH OBSERVATION FREQUENCIES With a large number of</span></span></span>
<span class="r-in"><span><span class="co"># assessors taking on a relatively low number of unique rankings, the</span></span></span>
<span class="r-in"><span><span class="co"># observation_frequency argument allows providing a rankings matrix with the</span></span></span>
<span class="r-in"><span><span class="co"># unique set of rankings, and the observation_frequency vector giving the number</span></span></span>
<span class="r-in"><span><span class="co"># of assessors with each ranking. This is illustrated here for the potato_visual</span></span></span>
<span class="r-in"><span><span class="co"># dataset</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># assume each row of potato_visual corresponds to between 1 and 5 assessors, as</span></span></span>
<span class="r-in"><span><span class="co"># given by the observation_frequency vector</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">observation_frequency</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample.int</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">5</span>, size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">potato_visual</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">m</span> <span class="op">&lt;-</span> <span class="fu">compute_mallows</span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="setup_rank_data.html">setup_rank_data</a></span><span class="op">(</span>rankings <span class="op">=</span> <span class="va">potato_visual</span>, observation_frequency <span class="op">=</span> <span class="va">observation_frequency</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># INTRANSITIVE PAIRWISE PREFERENCES</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu">compute_mallows</span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="setup_rank_data.html">setup_rank_data</a></span><span class="op">(</span>preferences <span class="op">=</span> <span class="va">bernoulli_data</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    compute_options <span class="op">=</span> <span class="fu"><a href="set_compute_options.html">set_compute_options</a></span><span class="op">(</span>nmc <span class="op">=</span> <span class="fl">5000</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    priors <span class="op">=</span> <span class="fu"><a href="set_priors.html">set_priors</a></span><span class="op">(</span>kappa <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    model_options <span class="op">=</span> <span class="fu"><a href="set_model_options.html">set_model_options</a></span><span class="op">(</span>error_model <span class="op">=</span> <span class="st">"bernoulli"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="assess_convergence.html">assess_convergence</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="assess_convergence.html">assess_convergence</a></span><span class="op">(</span><span class="va">mod</span>, parameter <span class="op">=</span> <span class="st">"theta"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="burnin.html">burnin</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">3000</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mod</span>, parameter <span class="op">=</span> <span class="st">"theta"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span><span class="co"># CHEKING FOR LABEL SWITCHING</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span>  <span class="co"># This example shows how to assess if label switching happens in BayesMallows</span></span></span>
<span class="r-in"><span>  <span class="co"># We start by creating a directory in which csv files with individual</span></span></span>
<span class="r-in"><span>  <span class="co"># cluster probabilities should be saved in each step of the MCMC algorithm</span></span></span>
<span class="r-in"><span>  <span class="co"># NOTE: For computational efficiency, we use much fewer MCMC iterations than one</span></span></span>
<span class="r-in"><span>  <span class="co"># would normally do.</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="st">"./test_label_switch"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="co"># Next, we go into this directory</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">setwd</a></span><span class="op">(</span><span class="st">"./test_label_switch/"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="co"># For comparison, we run compute_mallows with and without saving the cluster</span></span></span>
<span class="r-in"><span>  <span class="co"># probabilities The purpose of this is to assess the time it takes to save</span></span></span>
<span class="r-in"><span>  <span class="co"># the cluster probabilites.</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu">compute_mallows</span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="setup_rank_data.html">setup_rank_data</a></span><span class="op">(</span>rankings <span class="op">=</span> <span class="va">sushi_rankings</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    model_options <span class="op">=</span> <span class="fu"><a href="set_model_options.html">set_model_options</a></span><span class="op">(</span>n_clusters <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    compute_options <span class="op">=</span> <span class="fu"><a href="set_compute_options.html">set_compute_options</a></span><span class="op">(</span>nmc <span class="op">=</span> <span class="fl">500</span>, save_ind_clus <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="co"># With this options, compute_mallows will save cluster_probs2.csv,</span></span></span>
<span class="r-in"><span>  <span class="co"># cluster_probs3.csv, ..., cluster_probs[nmc].csv.</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu">compute_mallows</span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="setup_rank_data.html">setup_rank_data</a></span><span class="op">(</span>rankings <span class="op">=</span> <span class="va">sushi_rankings</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    model_options <span class="op">=</span> <span class="fu"><a href="set_model_options.html">set_model_options</a></span><span class="op">(</span>n_clusters <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    compute_options <span class="op">=</span> <span class="fu"><a href="set_compute_options.html">set_compute_options</a></span><span class="op">(</span>nmc <span class="op">=</span> <span class="fl">500</span>, save_ind_clus <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Next, we check convergence of alpha</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="assess_convergence.html">assess_convergence</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># We set the burnin to 200</span></span></span>
<span class="r-in"><span>  <span class="va">burnin</span> <span class="op">&lt;-</span> <span class="fl">200</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Find all files that were saved. Note that the first file saved is</span></span></span>
<span class="r-in"><span>  <span class="co"># cluster_probs2.csv</span></span></span>
<span class="r-in"><span>  <span class="va">cluster_files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"cluster\\_probs[[:digit:]]+\\.csv"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Check the size of the files that were saved.</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">file.size</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">cluster_files</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fl">1e-6</span>, <span class="st">"MB"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Find the iteration each file corresponds to, by extracting its number</span></span></span>
<span class="r-in"><span>  <span class="va">iteration_number</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/regmatches.html" class="external-link">regmatches</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">cluster_files</span>,m <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">regexpr</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"[0-9]+"</span>, <span class="va">cluster_files</span><span class="op">)</span></span></span>
<span class="r-in"><span>               <span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="co"># Remove all files before burnin</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.remove</a></span><span class="op">(</span><span class="va">cluster_files</span><span class="op">[</span><span class="va">iteration_number</span> <span class="op">&lt;=</span> <span class="va">burnin</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="co"># Update the vector of files, after the deletion</span></span></span>
<span class="r-in"><span>  <span class="va">cluster_files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"cluster\\_probs[[:digit:]]+\\.csv"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="co"># Create 3d array, with dimensions (iterations, assessors, clusters)</span></span></span>
<span class="r-in"><span>  <span class="va">prob_array</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">cluster_files</span><span class="op">)</span>, <span class="va">m</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">n_assessors</span>, <span class="va">m</span><span class="op">$</span><span class="va">n_clusters</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="co"># Read each file, adding to the right element of the array</span></span></span>
<span class="r-in"><span>  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">cluster_files</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="va">prob_array</span><span class="op">[</span><span class="va">i</span>, , <span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="va">cluster_files</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, header <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Create an integer array of latent allocations, as this is required by</span></span></span>
<span class="r-in"><span>  <span class="co"># label.switching</span></span></span>
<span class="r-in"><span>  <span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">m</span><span class="op">$</span><span class="va">cluster_assignment</span>, <span class="va">iteration</span> <span class="op">&gt;</span> <span class="va">burnin</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">z</span><span class="op">$</span><span class="va">value</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"Cluster "</span>, <span class="st">""</span>, <span class="va">z</span><span class="op">$</span><span class="va">value</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">z</span><span class="op">$</span><span class="va">chain</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span></span>
<span class="r-in"><span>  <span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/reshape.html" class="external-link">reshape</a></span><span class="op">(</span><span class="va">z</span>, direction <span class="op">=</span> <span class="st">"wide"</span>, idvar <span class="op">=</span> <span class="st">"iteration"</span>, timevar <span class="op">=</span> <span class="st">"assessor"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">z</span><span class="op">$</span><span class="va">iteration</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span></span>
<span class="r-in"><span>  <span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Now apply Stephen's algorithm</span></span></span>
<span class="r-in"><span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">label.switching</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">switch_check</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/label.switching/man/label.switching.html" class="external-link">label.switching</a></span><span class="op">(</span><span class="st">"STEPHENS"</span>, z <span class="op">=</span> <span class="va">z</span>,</span></span>
<span class="r-in"><span>                                  K <span class="op">=</span> <span class="va">m</span><span class="op">$</span><span class="va">n_clusters</span>, p <span class="op">=</span> <span class="va">prob_array</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Check the proportion of cluster assignments that were switched</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">switch_check</span><span class="op">$</span><span class="va">permutations</span><span class="op">$</span><span class="va">STEPHENS</span>, <span class="fl">1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">x</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">m</span><span class="op">$</span><span class="va">n_clusters</span>, by <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Remove the rest of the csv files</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.remove</a></span><span class="op">(</span><span class="va">cluster_files</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="co"># Move up one directory</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">setwd</a></span><span class="op">(</span><span class="st">".."</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="co"># Remove the directory in which the csv files were saved</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.remove</a></span><span class="op">(</span><span class="st">"./test_label_switch/"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Oystein Sorensen, Waldir Leoncio, Valeria Vitelli, Marta Crispino, Qinghua Liu, Cristina Mollica, Luca Tardella, Anja Stein.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer></div>





  </body></html>

